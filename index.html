<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Creating CYOA - Grade 7 Story Builder</title>

    <!-- React / Babel / Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Merriweather:ital,wght@0,300;0,700;1,400&display=swap" rel="stylesheet" />

    <style>
        body {
            font-family: "Inter", sans-serif;
            background-color: #f3f4f6;
        }
        .serif-text {
            font-family: "Merriweather", serif;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Sync spinner */
        .sync-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase setup: uses your own config, works on GitHub Pages -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import {
            getAuth,
            GoogleAuthProvider,
            signInWithPopup,
            signOut,
            onAuthStateChanged,
            setPersistence,
            browserLocalPersistence
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import {
            getFirestore,
            doc,
            getDoc,
            setDoc,
            collection,
            addDoc
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- YOUR FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyBGGLJcXB0xiVJ1L6iQkg765rCxwjFj-ho",
            authDomain: "story-builder-7e201.firebaseapp.com",
            projectId: "story-builder-7e201",
            storageBucket: "story-builder-7e201.firebasestorage.app",
            messagingSenderId: "275747156",
            appId: "1:275747156:web:0a677fe6073a49936578c1",
            measurementId: "G-0KPYMPBV4C"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Keep login between refreshes
        setPersistence(auth, browserLocalPersistence).catch(console.error);

        // Expose what the React app needs
        window.firebase = {
            app,
            auth,
            db,
            GoogleAuthProvider,
            signInWithPopup,
            signOut,
            onAuthStateChanged,
            doc,
            getDoc,
            setDoc,
            collection,
            addDoc
        };
    </script>

    <!-- React app -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Initial data -----------------------------------------------------
        const INITIAL_METADATA = {
            title: "My Interactive Story",
            author: "A Grade 7 Author",
            genre: "Fantasy",
            goal: "Define your main character’s central desire or quest.",
            conflict: "Define the challenge or antagonist that prevents the goal from being easily met."
        };

        const SAMPLE_NODE = {
            id: "start",
            title: "The Beginning",
            content:
                "Set the scene here. Describe the setting (where your character is) and the first challenge or decision they must face to begin their journey.\n\n[PROMPT: Describe your character’s immediate surroundings using sensory details (sight, sound, smell).]",
            choices: [
                { id: "c1", text: "Write the first choice here (e.g., Go left)", targetId: null },
                { id: "c2", text: "Write the second choice here (e.g., Go right)", targetId: null }
            ]
        };

        const INITIAL_NODES = [SAMPLE_NODE];

        // --- Icons / Toast / Share modal -------------------------------------
        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                BookOpen: (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
                    </svg>
                ),
                Map: (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6" />
                        <line x1="8" y1="2" x2="8" y2="18" />
                        <line x1="16" y1="6" x2="16" y2="22" />
                    </svg>
                ),
                Share: (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8" />
                        <polyline points="16 6 12 2 8 6" />
                        <line x1="12" y1="2" x2="12" y2="15" />
                    </svg>
                ),
                Play: (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <polygon points="5 3 19 12 5 21 5 3" />
                    </svg>
                ),
                Plus: (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19" />
                        <line x1="5" y1="12" x2="19" y2="12" />
                    </svg>
                ),
                Check: (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <polyline points="20 6 9 17 4 12" />
                    </svg>
                ),
                Link: (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
                    </svg>
                ),
                X: (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                ),
                Trash: (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <polyline points="3 6 5 6 21 6" />
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                    </svg>
                ),
                Copy: (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                    </svg>
                ),
                Edit: (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                    </svg>
                ),
                Refresh: (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <polyline points="23 4 23 10 17 10" />
                        <polyline points="1 20 1 14 7 14" />
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
                    </svg>
                ),
                Download: (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="7 10 12 15 17 10" />
                        <line x1="12" y1="15" x2="12" y2="3" />
                    </svg>
                ),
                Upload: (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="17 8 12 3 7 8" />
                        <line x1="12" y1="3" x2="12" y2="15" />
                    </svg>
                ),
                CloudOff: (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <line x1="1" y1="1" x2="23" y2="23"></line>
                        <path d="M22.61 16.95A5 5 0 0 0 18 10h-1.26a8 8 0 0 0-7.05-6M5 5a8 8 0 0 0 4 7h1.8a5 5 0 0 0 1.8 1.18l2.44-2.44A2.99 2.99 0 0 1 15 11a3 3 0 0 1 3 3"></path>
                        <path d="M9 16a5 5 0 0 0 6.63.16"></path>
                    </svg>
                )
            };
            return <div className={className}>{icons[name] || icons.BookOpen}</div>;
        };

        const Toast = ({ message, onClose }) => {
            if (!message) return null;
            return (
                <div className="fixed bottom-4 right-4 bg-slate-800 text-white px-4 py-3 rounded-lg shadow-xl flex items-center gap-3 fade-in z-50 border border-slate-700">
                    <span className="font-medium">{message}</span>
                    <button onClick={onClose} className="hover:text-slate-300 opacity-70 hover:opacity-100">
                        <Icon name="X" size={16} />
                    </button>
                </div>
            );
        };

        const ShareModal = ({ isOpen, onClose, shareUrl, showToast }) => {
            const urlInputRef = useRef(null);
            const [manualCopy, setManualCopy] = useState(false);

            useEffect(() => {
                if (isOpen && urlInputRef.current) {
                    // Auto-select when opening
                    setTimeout(() => {
                        if (urlInputRef.current) {
                            urlInputRef.current.select();
                        }
                    }, 50);
                }
            }, [isOpen]);

            if (!isOpen) return null;

            const handleCopy = async () => {
                if (!shareUrl) return;
                try {
                    await navigator.clipboard.writeText(shareUrl);
                    showToast("Share URL copied to clipboard!");
                    setManualCopy(false);
                } catch (e) {
                    // Fallback: ask user to copy manually
                    setManualCopy(true);
                    if (urlInputRef.current) {
                        urlInputRef.current.select();
                    }
                }
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center fade-in">
                    <div className="bg-white rounded-xl shadow-2xl p-8 w-full max-w-lg mx-4">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-2xl font-bold text-indigo-700 flex items-center gap-2">
                                <Icon name="Share" size={24} /> Share Project
                            </h3>
                            <button onClick={onClose} className="text-slate-400 hover:text-slate-700 p-1 rounded-full">
                                <Icon name="X" size={20} />
                            </button>
                        </div>

                        <div className="space-y-4 mb-6">
                            <p className="text-sm text-slate-700 leading-relaxed">
                                Share this link so others can read your story snapshot.
                            </p>

                            <div className="flex border border-slate-300 rounded-lg overflow-hidden">
                                <input
                                    ref={urlInputRef}
                                    readOnly
                                    value={shareUrl || ""}
                                    className="flex-1 p-3 text-sm font-mono bg-white focus:outline-none"
                                    onClick={e => e.target.select()}
                                />
                                <button
                                    onClick={handleCopy}
                                    className="px-4 py-3 bg-indigo-600 text-white hover:bg-indigo-700 transition-colors flex items-center gap-2"
                                >
                                    <Icon name="Copy" size={16} /> Copy
                                </button>
                            </div>

                            {manualCopy && (
                                <div className="bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg mt-4 fade-in">
                                    <p className="text-sm text-red-700 font-bold">Manual copy needed</p>
                                    <p className="text-xs text-red-600 mt-1">
                                        The URL has been highlighted. Press Ctrl+C (Windows/Chromebook) or Cmd+C (Mac) to copy it.
                                    </p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // --- Planner / Builder / Player --------------------------------------
        const Checklist = () => (
            <div className="bg-yellow-50 border-l-4 border-yellow-400 p-5 mb-8 rounded-r-lg shadow-sm">
                <h3 className="font-bold text-yellow-800 flex items-center gap-2 text-lg">
                    <Icon name="Check" size={20} /> Grade 7 Writer's Checklist
                </h3>
                <ul className="mt-3 text-sm text-yellow-800 space-y-2 ml-1">
                    <li className="flex gap-2">
                        <span className="font-bold">• Voice:</span> Does your narrator sound consistent throughout?
                    </li>
                    <li className="flex gap-2">
                        <span className="font-bold">• Sensory Details:</span> Describe what you see, hear, smell, and feel.
                    </li>
                    <li className="flex gap-2">
                        <span className="font-bold">• Organization:</span> Do the choices make logical sense for the character?
                    </li>
                    <li className="flex gap-2">
                        <span className="font-bold">• Conventions:</span> Check your spelling, punctuation, and grammar.
                    </li>
                </ul>
            </div>
        );

        const Planner = ({ metadata, setMetadata, readOnly }) => {
            const GENRES = ["Fantasy", "Sci-Fi", "Mystery", "Survival", "Historical Fiction", "Horror", "Comedy"];

            const handleMetaChange = (field, value) => {
                if (readOnly) return;
                setMetadata({ ...metadata, [field]: value });
            };

            return (
                <div className="max-w-3xl mx-auto fade-in pb-12">
                    <h2 className="text-3xl font-extrabold text-slate-800 mb-6 tracking-tight">Step 1: The Blueprint</h2>
                    <Checklist />
                    <div className="grid gap-6">
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label className="block text-sm font-bold text-slate-500 uppercase tracking-wide mb-2">Story Title</label>
                            <input
                                type="text"
                                value={metadata.title}
                                onChange={e => handleMetaChange("title", e.target.value)}
                                disabled={readOnly}
                                className={
                                    "w-full p-4 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none text-xl font-bold text-slate-800" +
                                    (readOnly ? " bg-slate-50 cursor-default" : "")
                                }
                                placeholder="e.g. The Mystery of the Missing Key"
                            />
                        </div>
                        <div className="grid md:grid-cols-2 gap-6">
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <label className="block text-sm font-bold text-slate-500 uppercase tracking-wide mb-2">Author</label>
                                <input
                                    type="text"
                                    value={metadata.author}
                                    onChange={e => handleMetaChange("author", e.target.value)}
                                    disabled={readOnly}
                                    className={
                                        "w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500" +
                                        (readOnly ? " bg-slate-50 cursor-default" : "")
                                    }
                                />
                            </div>
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <label className="block text-sm font-bold text-slate-500 uppercase tracking-wide mb-2">Genre</label>
                                <select
                                    value={metadata.genre}
                                    onChange={e => handleMetaChange("genre", e.target.value)}
                                    disabled={readOnly}
                                    className={
                                        "w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 bg-white" +
                                        (readOnly ? " bg-slate-50 cursor-default" : "")
                                    }
                                >
                                    {GENRES.map(g => (
                                        <option key={g} value={g}>
                                            {g}
                                        </option>
                                    ))}
                                </select>
                            </div>
                        </div>
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <h3 className="font-bold text-slate-800 mb-4 text-lg">The Narrative Arc</h3>
                            <div className="space-y-6">
                                <div>
                                    <label className="block text-sm font-bold text-slate-500 uppercase tracking-wide mb-2">The Goal</label>
                                    <textarea
                                        className={
                                            "w-full p-4 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 h-24" +
                                            (readOnly ? " bg-slate-50 cursor-default" : "")
                                        }
                                        value={metadata.goal}
                                        onChange={e => handleMetaChange("goal", e.target.value)}
                                        disabled={readOnly}
                                    ></textarea>
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-slate-500 uppercase tracking-wide mb-2">The Conflict</label>
                                    <textarea
                                        className={
                                            "w-full p-4 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 h-24" +
                                            (readOnly ? " bg-slate-50 cursor-default" : "")
                                        }
                                        value={metadata.conflict}
                                        onChange={e => handleMetaChange("conflict", e.target.value)}
                                        disabled={readOnly}
                                    ></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const Builder = ({ nodes, setNodes, activeNodeId, setActiveNodeId, showToast, readOnly }) => {
            const activeNode = nodes.find(n => n.id === activeNodeId) || nodes[0];
            const [deleteConfirmId, setDeleteConfirmId] = useState(null);

            const updateNode = (field, value) => {
                if (readOnly) return;
                setNodes(nodes.map(n => (n.id === activeNodeId ? { ...n, [field]: value } : n)));
            };

            const addChoice = () => {
                if (readOnly) return;
                const newChoice = { id: Date.now().toString(), text: "New Option", targetId: null };
                updateNode("choices", [...activeNode.choices, newChoice]);
            };

            const updateChoice = (choiceId, field, value) => {
                if (readOnly) return;
                const updatedChoices = activeNode.choices.map(c => (c.id === choiceId ? { ...c, [field]: value } : c));
                updateNode("choices", updatedChoices);
            };

            const removeChoice = choiceId => {
                if (readOnly) return;
                updateNode(
                    "choices",
                    activeNode.choices.filter(c => c.id !== choiceId)
                );
            };

            const createNewPageForChoice = choiceId => {
                if (readOnly) return;
                const newPageId = "page-" + Date.now();
                const newPage = {
                    id: newPageId,
                    title: "New Scene",
                    content: "Write what happens next...",
                    choices: []
                };
                setNodes([...nodes, newPage]);
                updateChoice(choiceId, "targetId", newPageId);
                setTimeout(() => setActiveNodeId(newPageId), 100);
                showToast("New page created & linked!");
            };

            const deleteNode = id => {
                if (readOnly) return;
                if (nodes.length <= 1) {
                    showToast("You can't delete the only page!");
                    return;
                }
                const newNodes = nodes.filter(n => n.id !== id);
                const cleanedNodes = newNodes.map(n => ({
                    ...n,
                    choices: n.choices.map(c => ({
                        ...c,
                        targetId: c.targetId === id ? null : c.targetId
                    }))
                }));

                setNodes(cleanedNodes);
                setActiveNodeId(cleanedNodes[0].id);
                setDeleteConfirmId(null);
                showToast("Page deleted and links updated.");
            };

            return (
                <div className="flex h-[calc(100vh-140px)] gap-4 fade-in">
                    {/* Left Sidebar */}
                    <div className="w-1/4 min-w-[250px] bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col overflow-hidden">
                        <div className="p-4 bg-slate-50 border-b border-slate-200 font-bold text-slate-700 flex justify-between items-center">
                            <span>Your Pages</span>
                            <span className="text-xs bg-indigo-100 text-indigo-700 px-2.5 py-1 rounded-full font-bold">
                                {nodes.length} Scenes
                            </span>
                        </div>
                        <div className="overflow-y-auto flex-1 p-3 space-y-2">
                            {nodes.map(node => {
                                const isLinked = nodes.some(n => n.choices.some(c => c.targetId === node.id));
                                const isStart = node.id === "start";
                                return (
                                    <div
                                        key={node.id}
                                        onClick={() => setActiveNodeId(node.id)}
                                        className={
                                            "p-3 rounded-lg cursor-pointer text-sm border transition-all " +
                                            (activeNodeId === node.id
                                                ? "bg-indigo-50 border-indigo-500 shadow-md transform scale-[1.02]"
                                                : "bg-white border-slate-200 hover:bg-slate-50")
                                        }
                                    >
                                        <div className="font-bold text-slate-800 truncate">{node.title}</div>
                                        <div className="flex flex-wrap items-center gap-1.5 mt-2">
                                            {isStart && (
                                                <span className="text-[10px] uppercase font-bold bg-green-100 text-green-700 px-1.5 py-0.5 rounded">
                                                    Start
                                                </span>
                                            )}
                                            {node.choices.length === 0 && !isStart && (
                                                <span className="text-[10px] uppercase font-bold bg-red-100 text-red-700 px-1.5 py-0.5 rounded">
                                                    Ending
                                                </span>
                                            )}
                                            {!isLinked && !isStart && (
                                                <span className="text-[10px] uppercase font-bold bg-yellow-100 text-yellow-700 px-1.5 py-0.5 rounded">
                                                    Unlinked
                                                </span>
                                            )}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                        <div className="p-3 border-t bg-slate-50">
                            {!readOnly && (
                                <button
                                    onClick={() => {
                                        const newId = "page-" + Date.now();
                                        setNodes([...nodes, { id: newId, title: "New Scene", content: "", choices: [] }]);
                                        setActiveNodeId(newId);
                                    }}
                                    className="w-full py-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-semibold flex justify-center items-center gap-2 shadow-sm"
                                >
                                    <Icon name="Plus" size={16} /> New Independent Page
                                </button>
                            )}
                            {readOnly && (
                                <p className="text-[11px] text-slate-400 text-center px-2">
                                    Read-only view – page list is still clickable.
                                </p>
                            )}
                        </div>
                    </div>

                    {/* Editor area */}
                    <div className="flex-1 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col overflow-hidden">
                        <div className="p-6 border-b border-slate-100 flex justify-between items-start bg-slate-50/50">
                            <div className="w-2/3">
                                <label className="text-xs font-bold text-slate-400 uppercase tracking-wide">Scene Title</label>
                                <input
                                    type="text"
                                    value={activeNode.title}
                                    onChange={e => updateNode("title", e.target.value)}
                                    disabled={readOnly}
                                    className={
                                        "text-2xl font-bold text-slate-800 w-full focus:outline-none bg-transparent placeholder-slate-300" +
                                        (readOnly ? " cursor-default" : "")
                                    }
                                />
                            </div>
                            {!readOnly && activeNode.id !== "start" && (
                                <div className="flex items-center">
                                    {deleteConfirmId === activeNode.id ? (
                                        <div className="flex items-center gap-2 bg-red-50 p-1.5 rounded-lg border border-red-100">
                                            <span className="text-xs text-red-700 font-bold">Delete?</span>
                                            <button
                                                onClick={() => deleteNode(activeNode.id)}
                                                className="text-xs bg-red-600 text-white px-3 py-1 rounded"
                                            >
                                                Yes
                                            </button>
                                            <button
                                                onClick={() => setDeleteConfirmId(null)}
                                                className="text-xs text-slate-500 px-2"
                                            >
                                                No
                                            </button>
                                        </div>
                                    ) : (
                                        <button
                                            onClick={() => setDeleteConfirmId(activeNode.id)}
                                            className="text-slate-400 hover:text-red-600 p-2"
                                        >
                                            <Icon name="Trash" size={20} />
                                        </button>
                                    )}
                                </div>
                            )}
                        </div>
                        <div className="flex-1 flex flex-col md:flex-row h-full overflow-hidden">
                            <div className="flex-1 p-6 border-r border-slate-100 flex flex-col h-full overflow-hidden">
                                <label className="text-xs font-bold text-slate-400 uppercase tracking-wide mb-2">Story Text</label>
                                <textarea
                                    value={activeNode.content}
                                    onChange={e => updateNode("content", e.target.value)}
                                    disabled={readOnly}
                                    className={
                                        "flex-1 w-full resize-none focus:outline-none text-lg leading-relaxed text-slate-700 serif-text p-2 -ml-2 rounded hover:bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-50 transition-all" +
                                        (readOnly ? " bg-slate-50 cursor-default" : "")
                                    }
                                    placeholder="Write your story here..."
                                ></textarea>
                                <div className="pt-2 border-t border-slate-50 text-right">
                                    <p className="text-xs text-slate-400 font-medium">
                                        {activeNode.content.split(/\s+/).filter(w => w.length > 0).length} words
                                    </p>
                                </div>
                            </div>
                            <div className="w-full md:w-80 bg-slate-50 p-6 overflow-y-auto border-l border-slate-100">
                                <div className="flex justify-between items-center mb-6">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-wide">
                                        Choices ({activeNode.choices.length})
                                    </label>
                                    {!readOnly && (
                                        <button
                                            onClick={addChoice}
                                            className="text-indigo-600 hover:text-indigo-800 text-xs font-bold flex items-center gap-1 bg-indigo-50 px-2 py-1 rounded"
                                        >
                                            <Icon name="Plus" size={14} /> Add Choice
                                        </button>
                                    )}
                                </div>
                                <div className="space-y-4">
                                    {activeNode.choices.map(choice => (
                                        <div
                                            key={choice.id}
                                            className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 relative group"
                                        >
                                            <div className="mb-3">
                                                <label className="text-[10px] text-slate-500 font-bold block mb-1.5 uppercase tracking-wider">
                                                    Button Text
                                                </label>
                                                <input
                                                    type="text"
                                                    value={choice.text}
                                                    onChange={e => updateChoice(choice.id, "text", e.target.value)}
                                                    disabled={readOnly}
                                                    className={
                                                        "w-full p-2 border border-slate-200 rounded text-sm focus:border-indigo-500 focus:outline-none" +
                                                        (readOnly ? " bg-slate-50 cursor-default" : "")
                                                    }
                                                />
                                            </div>
                                            <div>
                                                <label className="text-[10px] text-slate-500 font-bold block mb-1.5 uppercase tracking-wider">
                                                    Leads To
                                                </label>
                                                <div className="flex gap-2">
                                                    <select
                                                        value={choice.targetId || ""}
                                                        onChange={e =>
                                                            updateChoice(choice.id, "targetId", e.target.value || null)
                                                        }
                                                        disabled={readOnly}
                                                        className={
                                                            "flex-1 p-2 border border-slate-200 rounded text-sm focus:border-indigo-500 focus:outline-none bg-white" +
                                                            (readOnly ? " bg-slate-50 cursor-default" : "")
                                                        }
                                                    >
                                                        <option value="">Select a page...</option>
                                                        {nodes
                                                            .filter(n => n.id !== activeNode.id)
                                                            .map(n => (
                                                                <option key={n.id} value={n.id}>
                                                                    {n.title}
                                                                </option>
                                                            ))}
                                                    </select>
                                                    {!readOnly && !choice.targetId && (
                                                        <button
                                                            onClick={() => createNewPageForChoice(choice.id)}
                                                            className="bg-indigo-100 text-indigo-700 p-2 rounded hover:bg-indigo-200"
                                                            title="Create New Page"
                                                        >
                                                            <Icon name="Plus" size={16} />
                                                        </button>
                                                    )}
                                                </div>
                                            </div>
                                            {!readOnly && (
                                                <button
                                                    onClick={() => removeChoice(choice.id)}
                                                    className="absolute -top-2 -right-2 bg-white text-slate-400 hover:text-red-500 rounded-full p-1 shadow border border-slate-200 opacity-0 group-hover:opacity-100 transition-opacity"
                                                >
                                                    <Icon name="X" size={14} />
                                                </button>
                                            )}
                                        </div>
                                    ))}
                                    {activeNode.choices.length === 0 && (
                                        <div className="text-center p-6 border-2 border-dashed border-slate-200 rounded-lg">
                                            <p className="text-xs text-slate-400">
                                                No choices yet.
                                                <br />
                                                This page is an ending.
                                            </p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const Player = ({ nodes, metadata }) => {
            const [history, setHistory] = useState(["start"]);
            const currentNode = nodes.find(n => n.id === history[history.length - 1]) || nodes[0];

            const handleChoice = targetId => {
                if (targetId) {
                    setHistory([...history, targetId]);
                }
            };

            const restart = () => setHistory(["start"]);
            const goBack = () => {
                if (history.length > 1) {
                    setHistory(history.slice(0, -1));
                }
            };

            return (
                <div className="max-w-2xl mx-auto fade-in pb-20">
                    <div className="bg-white rounded-xl shadow-xl border border-slate-200 overflow-hidden min-h-[60vh] flex flex-col relative">
                        <div className="bg-indigo-600 p-8 text-white text-center relative overflow-hidden">
                            <div className="relative z-10">
                                <h1 className="text-3xl font-bold font-serif mb-2">{metadata.title}</h1>
                                <p className="text-indigo-200 text-sm font-medium">By {metadata.author}</p>
                            </div>
                            <div className="absolute inset-0 bg-gradient-to-b from-transparent to-indigo-800 opacity-50"></div>
                        </div>
                        <div className="p-8 md:p-12 flex-1 flex flex-col">
                            <h2 className="text-xl font-bold text-slate-800 mb-6 pb-4 border-b border-slate-100">
                                {currentNode.title}
                            </h2>
                            <div className="prose prose-slate max-w-none mb-8 flex-1">
                                <p className="whitespace-pre-wrap text-lg leading-relaxed text-slate-700 serif-text">
                                    {currentNode.content}
                                </p>
                            </div>
                            <div className="space-y-3 mt-auto">
                                {currentNode.choices.length > 0 ? (
                                    currentNode.choices.map(choice => (
                                        <button
                                            key={choice.id}
                                            onClick={() => handleChoice(choice.targetId)}
                                            className="w-full p-4 text-left border-2 border-slate-100 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all font-medium text-slate-700 hover:text-indigo-700 flex justify-between group"
                                        >
                                            <span>{choice.text}</span>
                                            <span className="opacity-0 group-hover:opacity-100 text-indigo-500">→</span>
                                        </button>
                                    ))
                                ) : (
                                    <div className="text-center py-8 bg-slate-50 rounded-lg border border-slate-100">
                                        <p className="text-slate-500 font-bold mb-4">The End</p>
                                        <button
                                            onClick={restart}
                                            className="inline-flex items-center gap-2 text-indigo-600 font-bold hover:underline"
                                        >
                                            <Icon name="Refresh" size={16} /> Play Again
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                        {history.length > 1 && (
                            <div className="bg-slate-50 p-4 border-t border-slate-200 flex justify-between text-sm text-slate-500">
                                <button onClick={goBack} className="hover:text-indigo-600">
                                    ← Back
                                </button>
                                <span>Page {history.length}</span>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- Main App ---------------------------------------------------------
        const App = () => {
            const [activeTab, setActiveTab] = useState("planner");
            const [metadata, setMetadata] = useState(INITIAL_METADATA);
            const [nodes, setNodes] = useState(INITIAL_NODES);
            const [activeNodeId, setActiveNodeId] = useState("start");

            const [firebaseUser, setFirebaseUser] = useState(null);
            const [authReady, setAuthReady] = useState(false);

            const [isSnapshotMode, setIsSnapshotMode] = useState(false);
            const [snapshotId, setSnapshotId] = useState(null);
            const [isLoadingSnapshot, setIsLoadingSnapshot] = useState(false);
            const [snapshotError, setSnapshotError] = useState(null);

            const [toast, setToast] = useState(null);
            const [isSyncing, setIsSyncing] = useState(false);
            const [isShareOpen, setIsShareOpen] = useState(false);
            const [shareUrl, setShareUrl] = useState("");
            const [shareBusy, setShareBusy] = useState(false);

            const fileInputRef = useRef(null);

            const showToast = msg => {
                setToast(msg);
                setTimeout(() => setToast(null), 3000);
            };

            // Detect snapshot mode from URL (?snapshot=ID)
            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const s = params.get("snapshot");
                if (s) {
                    setIsSnapshotMode(true);
                    setSnapshotId(s);
                    setActiveTab("planner"); // show everything, not just preview
                }
            }, []);

            // Firebase auth listener
            useEffect(() => {
                if (!window.firebase || !window.firebase.auth || !window.firebase.onAuthStateChanged) {
                    setAuthReady(true);
                    return;
                }

                const unsub = window.firebase.onAuthStateChanged(window.firebase.auth, user => {
                    setFirebaseUser(user || null);
                    setAuthReady(true);
                });

                return () => unsub && unsub();
            }, []);

            // Load story from Firestore for signed-in user (edit mode only)
            useEffect(() => {
                if (!authReady) return;
                if (isSnapshotMode) return;
                if (!firebaseUser) return;
                if (!window.firebase || !window.firebase.db || !window.firebase.doc || !window.firebase.getDoc) return;

                const load = async () => {
                    try {
                        const { db, doc, getDoc } = window.firebase;
                        const ref = doc(db, "stories", firebaseUser.uid);
                        const snap = await getDoc(ref);
                        if (snap.exists()) {
                            const data = snap.data();
                            if (data.metadata) setMetadata(data.metadata);
                            if (data.nodes && Array.isArray(data.nodes) && data.nodes.length > 0) {
                                setNodes(data.nodes);
                                const startNode = data.nodes.find(n => n.id === "start");
                                setActiveNodeId(startNode ? startNode.id : data.nodes[0].id);
                            }
                        }
                    } catch (e) {
                        console.error("Error loading story:", e);
                    }
                };
                load();
            }, [authReady, firebaseUser, isSnapshotMode]);

            // Load guest draft from localStorage (only if not signed in and not snapshot)
            useEffect(() => {
                if (!authReady) return;
                if (isSnapshotMode) return;
                if (firebaseUser) return;

                try {
                    const raw = window.localStorage.getItem("storybuilder-draft-v1");
                    if (!raw) return;
                    const json = JSON.parse(raw);
                    if (json.metadata) setMetadata(json.metadata);
                    if (json.nodes && Array.isArray(json.nodes) && json.nodes.length > 0) {
                        setNodes(json.nodes);
                        const startNode = json.nodes.find(n => n.id === "start");
                        setActiveNodeId(startNode ? startNode.id : json.nodes[0].id);
                    }
                } catch (e) {
                    console.error("Error loading local draft:", e);
                }
            }, [authReady, firebaseUser, isSnapshotMode]);

            // Load shared snapshot from Firestore
            useEffect(() => {
                if (!isSnapshotMode) return;
                if (!snapshotId) return;
                if (!window.firebase || !window.firebase.db || !window.firebase.doc || !window.firebase.getDoc) return;

                const loadSnapshot = async () => {
                    setIsLoadingSnapshot(true);
                    setSnapshotError(null);
                    try {
                        const { db, doc, getDoc } = window.firebase;
                        const ref = doc(db, "snapshots", snapshotId);
                        const snap = await getDoc(ref);
                        if (!snap.exists()) {
                            setSnapshotError("That shared story could not be found.");
                            setIsLoadingSnapshot(false);
                            return;
                        }
                        const data = snap.data();
                        if (data.metadata) setMetadata(data.metadata);
                        if (data.nodes && Array.isArray(data.nodes) && data.nodes.length > 0) {
                            setNodes(data.nodes);
                            const startNode = data.nodes.find(n => n.id === "start");
                            setActiveNodeId(startNode ? startNode.id : data.nodes[0].id);
                        }
                    } catch (e) {
                        console.error("Snapshot load error:", e);
                        setSnapshotError("Error loading this shared story.");
                    } finally {
                        setIsLoadingSnapshot(false);
                    }
                };

                loadSnapshot();
            }, [isSnapshotMode, snapshotId]);

            // Save to Firestore when signed in (edit mode, not snapshot)
            useEffect(() => {
                if (isSnapshotMode) return;
                if (!firebaseUser) return;
                if (!window.firebase || !window.firebase.db || !window.firebase.doc || !window.firebase.setDoc) return;

                const { db, doc, setDoc } = window.firebase;
                const storyRef = doc(db, "stories", firebaseUser.uid);

                const timeoutId = setTimeout(async () => {
                    try {
                        setIsSyncing(true);
                        await setDoc(storyRef, {
                            metadata,
                            nodes,
                            lastUpdated: new Date().toISOString()
                        });
                    } catch (e) {
                        console.error("Save error:", e);
                    } finally {
                        setIsSyncing(false);
                    }
                }, 1000); // debounce

                return () => clearTimeout(timeoutId);
            }, [metadata, nodes, firebaseUser, isSnapshotMode]);

            // Save guest draft to localStorage (no spinner)
            useEffect(() => {
                if (isSnapshotMode) return;
                if (firebaseUser) return;

                const timeoutId = setTimeout(() => {
                    try {
                        const payload = { metadata, nodes };
                        window.localStorage.setItem("storybuilder-draft-v1", JSON.stringify(payload));
                    } catch (e) {
                        console.error("Local save error:", e);
                    }
                }, 800);

                return () => clearTimeout(timeoutId);
            }, [metadata, nodes, firebaseUser, isSnapshotMode]);

            // --- Handlers ------------------------------------------------------
            const handleExport = () => {
                const dataStr = JSON.stringify({ metadata, nodes }, null, 2);
                const blob = new Blob([dataStr], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download = `${metadata.title.replace(/\s+/g, "_") || "story"}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showToast("Story exported to JSON!");
            };

            const handleImportClick = () => {
                if (fileInputRef.current) {
                    fileInputRef.current.click();
                }
            };

            const handleFileChange = event => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = e => {
                    try {
                        const json = JSON.parse(e.target.result);
                        if (json.metadata && json.nodes) {
                            setMetadata(json.metadata);
                            setNodes(json.nodes);
                            setActiveTab("builder");
                            showToast("Story imported successfully!");
                        } else {
                            showToast("Invalid file format. Missing metadata or nodes.");
                        }
                    } catch (error) {
                        console.error("Import error:", error);
                        showToast("Error parsing JSON file.");
                    }
                };
                reader.readAsText(file);
                event.target.value = null;
            };

            const handleGoogleSignIn = async () => {
                if (!window.firebase || !window.firebase.auth || !window.firebase.GoogleAuthProvider || !window.firebase.signInWithPopup) {
                    showToast("Sign-in is not available right now.");
                    return;
                }
                try {
                    const provider = new window.firebase.GoogleAuthProvider();
                    await window.firebase.signInWithPopup(window.firebase.auth, provider);
                    showToast("Signed in with Google!");
                } catch (e) {
                    console.error("Google sign-in error:", e);
                    showToast("Google sign-in failed.");
                }
            };

            const handleSignOut = async () => {
                if (!window.firebase || !window.firebase.auth || !window.firebase.signOut) return;
                try {
                    await window.firebase.signOut(window.firebase.auth);
                    showToast("Signed out.");
                } catch (e) {
                    console.error("Sign out error:", e);
                }
            };

            const handleShare = async () => {
                if (isSnapshotMode) return;
                if (!firebaseUser) {
                    showToast("Sign in with Google to create a share link.");
                    return;
                }
                if (!window.firebase || !window.firebase.db || !window.firebase.collection || !window.firebase.addDoc) {
                    showToast("Sharing is not available right now.");
                    return;
                }
                try {
                    setShareBusy(true);
                    const { db, collection, addDoc } = window.firebase;
                    const ref = await addDoc(collection(db, "snapshots"), {
                        ownerUid: firebaseUser.uid,
                        metadata,
                        nodes,
                        createdAt: new Date().toISOString()
                    });
                    const url = `${window.location.origin}${window.location.pathname}?snapshot=${ref.id}`;
                    setShareUrl(url);
                    setIsShareOpen(true);
                    showToast("Share link created!");
                } catch (e) {
                    console.error("Share error:", e);
                    showToast("Could not create share link.");
                } finally {
                    setShareBusy(false);
                }
            };

            const isReadOnly = isSnapshotMode;

            return (
                <div className="min-h-screen flex flex-col">
                    {/* Header */}
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-40">
                        <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-serif font-bold text-xl">
                                    S
                                </div>
                                <h1 className="font-bold text-slate-800 hidden sm:block">
                                    StoryBuilder <span className="text-slate-400 font-normal">| Grade 7</span>
                                </h1>
                            </div>

                            <div className="flex items-center gap-1 bg-slate-100 p-1 rounded-lg">
                                <button
                                    onClick={() => setActiveTab("planner")}
                                    className={
                                        "px-4 py-1.5 rounded-md text-sm font-bold transition-all " +
                                        (activeTab === "planner"
                                            ? "bg-white text-indigo-600 shadow-sm"
                                            : "text-slate-500 hover:text-slate-700")
                                    }
                                >
                                    1. Plan
                                </button>
                                <button
                                    onClick={() => setActiveTab("builder")}
                                    className={
                                        "px-4 py-1.5 rounded-md text-sm font-bold transition-all " +
                                        (activeTab === "builder"
                                            ? "bg-white text-indigo-600 shadow-sm"
                                            : "text-slate-500 hover:text-slate-700")
                                    }
                                >
                                    2. Build
                                </button>
                                <button
                                    onClick={() => setActiveTab("player")}
                                    className={
                                        "px-4 py-1.5 rounded-md text-sm font-bold transition-all " +
                                        (activeTab === "player"
                                            ? "bg-white text-indigo-600 shadow-sm"
                                            : "text-slate-500 hover:text-slate-700")
                                    }
                                >
                                    3. Preview
                                </button>
                            </div>

                            <div className="flex items-center gap-3">
                                {!isSnapshotMode && isSyncing && (
                                    <div className="flex items-center gap-2 text-xs text-slate-500">
                                        <div className="sync-spinner" />
                                        <span>Saving...</span>
                                    </div>
                                )}

                                {!isSnapshotMode && (
                                    <>
                                        <div className="hidden md:flex gap-2">
                                            <button
                                                onClick={handleExport}
                                                className="text-slate-500 hover:text-indigo-600 p-2 rounded-full hover:bg-slate-50 transition-colors"
                                                title="Export JSON"
                                            >
                                                <Icon name="Download" size={20} />
                                            </button>
                                            <button
                                                onClick={handleImportClick}
                                                className="text-slate-500 hover:text-indigo-600 p-2 rounded-full hover:bg-slate-50 transition-colors"
                                                title="Import JSON"
                                            >
                                                <Icon name="Upload" size={20} />
                                            </button>
                                            <input
                                                type="file"
                                                ref={fileInputRef}
                                                onChange={handleFileChange}
                                                accept=".json"
                                                className="hidden"
                                            />
                                        </div>
                                        <button
                                            onClick={handleShare}
                                            className="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 transition-colors"
                                        >
                                            <Icon name="Share" size={16} />
                                            {shareBusy ? "Sharing..." : "Share"}
                                        </button>
                                    </>
                                )}

                                {isSnapshotMode && (
                                    <span className="text-[11px] text-slate-400 hidden sm:inline">
                                        Viewing shared copy (read-only)
                                    </span>
                                )}

                                <div className="border-l h-6 border-slate-200 mx-1 hidden sm:block" />

                                {firebaseUser ? (
                                    <div className="flex items-center gap-2">
                                        <span className="text-[11px] text-slate-500 hidden md:inline">
                                            {firebaseUser.email || "Signed in"}
                                        </span>
                                        <button
                                            onClick={handleSignOut}
                                            className="text-xs font-semibold text-slate-600 hover:text-indigo-600 px-2 py-1 rounded-md hover:bg-slate-50"
                                        >
                                            Sign out
                                        </button>
                                    </div>
                                ) : !isSnapshotMode ? (
                                    <div className="flex items-center gap-2">
                                        <span className="text-[11px] text-slate-400 hidden md:inline">
                                            Working as guest (changes stay on this device unless you sign in)
                                        </span>
                                        <button
                                            onClick={handleGoogleSignIn}
                                            className="text-xs font-semibold text-white bg-red-500 hover:bg-red-600 px-3 py-1 rounded-md flex items-center gap-1"
                                        >
                                            <span className="bg-white text-red-500 rounded-full w-3 h-3 flex items-center justify-center text-[9px] font-bold">
                                                G
                                            </span>
                                            Sign in
                                        </button>
                                    </div>
                                ) : null}
                            </div>
                        </div>
                    </header>

                    {/* Main content */}
                    <main className="flex-1 p-6 max-w-7xl mx-auto w-full">
                        {isSnapshotMode && (
                            <div className="mb-4 text-sm">
                                {isLoadingSnapshot && (
                                    <p className="text-slate-500">Loading shared story…</p>
                                )}
                                {snapshotError && (
                                    <p className="text-red-500 font-semibold">{snapshotError}</p>
                                )}
                            </div>
                        )}

                        {activeTab === "planner" && (
                            <Planner metadata={metadata} setMetadata={setMetadata} readOnly={isReadOnly} />
                        )}
                        {activeTab === "builder" && (
                            <Builder
                                nodes={nodes}
                                setNodes={setNodes}
                                activeNodeId={activeNodeId}
                                setActiveNodeId={setActiveNodeId}
                                showToast={showToast}
                                readOnly={isReadOnly}
                            />
                        )}
                        {activeTab === "player" && <Player nodes={nodes} metadata={metadata} />}
                    </main>

                    <Toast message={toast} onClose={() => setToast(null)} />
                    <ShareModal
                        isOpen={isShareOpen}
                        onClose={() => setIsShareOpen(false)}
                        shareUrl={shareUrl}
                        showToast={showToast}
                    />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>
</body>
</html>
